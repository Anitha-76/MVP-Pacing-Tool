<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVP: Flexible Lesson Pacing Tool - Unit 1</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .rigid-schedule-section {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .rigid-schedule-section h2 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .schedule-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .schedule-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .schedule-table tbody tr:nth-child(even):not(.subject-header) {
            background: #fafbfc;
        }

        .schedule-table tbody tr:hover:not(.subject-header) {
            background: #f0f4ff;
            transition: background 0.2s ease;
        }

        .subject-header {
            background: #f0f2ff !important;
            font-weight: bold;
            color: #667eea;
        }

        .teacher-customized-cell {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%) !important;
            font-weight: bold;
            position: relative;
            box-shadow: inset 0 0 0 2px #ffc107;
        }

        .teacher-customized-cell::after {
            content: "‚úé";
            position: absolute;
            top: 2px;
            right: 5px;
            font-size: 0.8em;
            color: #856404;
        }

        .acceptance-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-top: 30px;
        }

        .acceptance-section h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .acceptance-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
        }

        .login-section {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
            display: none;
        }

        .login-section input {
            padding: 15px 25px;
            font-size: 1.1em;
            border: 2px solid #667eea;
            border-radius: 8px;
            margin-right: 15px;
            width: 300px;
        }

        .login-section button, .btn {
            padding: 15px 30px;
            font-size: 1.1em;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-section button:hover, .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-accept {
            background: #28a745;
        }

        .btn-accept:hover {
            background: #218838;
        }

        .btn-customize {
            background: #667eea;
        }

        .consolidated-view {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: none;
        }

        .consolidated-view h2 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }

        .teacher-column {
            min-width: 120px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .status-accepted {
            background: #d4edda;
            color: #155724;
        }

        .status-customized {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .main-content {
            display: none;
        }
        
        .welcome-bar {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .welcome-bar h2 {
            color: #667eea;
        }
        
        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .tab {
            flex: 1;
            padding: 20px;
            background: white;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .tab:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .subject-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .subject-content.active {
            display: block;
        }
        
        .schedule-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .schedule-box {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .schedule-box h3 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .topic-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .topic-row label {
            font-weight: 500;
            color: #333;
        }
        
        .topic-row input {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            font-size: 1em;
            text-align: center;
        }
        
        .topic-row input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .topic-row .hours-display {
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }
        
        .total-hours {
            margin-top: 20px;
            padding: 15px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .total-hours.warning {
            background: #dc3545;
        }
        
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .summary-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 30px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .summary-card {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .summary-card h4 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .summary-item {
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }
        
        .hidden {
            display: none;
        }
        
        @media print {
            body {
                background: white;
            }
            .login-section, .welcome-bar button, .action-buttons {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö MVP: Flexible Lesson Pacing Tool</h1>
            <p>Grade 6 - Unit 1 Planning Across Subjects</p>
            <p style="margin-top: 10px; font-style: italic;"><strong>Theory of Change:</strong> If teachers customize lesson pacing based on complexity of the topic, then students get adequate time to master content, so that their learning outcomes improve.<br>Below is the lesson schedule for Unit 1. Please review and decide if you'd like to accept or customize this plan.</p>
        </div>

        <!-- Step 1: Show Rigid Schedule -->
        <div class="rigid-schedule-section" id="rigidScheduleSection">
            <h2>üìã Schedule - Unit 1 (Mathematics, Science, Social Science)</h2>
            <div id="legendSection" style="display: none; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                <p style="margin: 0; font-size: 0.95em; color: #495057;">
                    <strong>Legend:</strong>
                    <span style="display: inline-block; margin: 0 15px;">
                        <span style="display: inline-block; width: 20px; height: 20px; background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%); border: 2px solid #ffc107; vertical-align: middle; border-radius: 3px; margin-right: 5px;"></span>
                        Customized by teacher
                    </span>
                    <span style="display: inline-block;">
                        <span style="display: inline-block; width: 20px; height: 20px; background: white; border: 1px solid #e9ecef; vertical-align: middle; border-radius: 3px; margin-right: 5px;"></span>
                        Accepted as-is
                    </span>
                </p>
            </div>
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Topic</th>
                        <th>Hours Allocated</th>
                    </tr>
                </thead>
                <tbody id="rigidScheduleTableBody">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>

            <div class="acceptance-section">
                <h3>Do you accept this rigid schedule or would you like to customize it?</h3>
                <p style="color: #666; margin-bottom: 20px;">
                    If you accept, the schedule will be used as-is. If you customize, you can adjust hours for each topic.
                </p>
                <div class="acceptance-buttons">
                    <button class="btn btn-accept" onclick="showLoginForAcceptance()">‚úì Accept Schedule</button>
                    <button class="btn btn-customize" onclick="showLoginForCustomization()">‚úèÔ∏è Customize Schedule</button>
                </div>
                <div id="consolidatedNavButtons" style="margin-top: 20px; display: none;">
                    <button class="btn" onclick="showConsolidatedView()" style="background: #28a745; margin-right: 10px;">üìä View Detailed Consolidated Report</button>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn" onclick="clearAllData()" style="background: #dc3545; font-size: 0.9em; padding: 10px 20px;">üóëÔ∏è Clear All Teacher Data</button>
                </div>
            </div>
        </div>

        <!-- Step 2: Login Section (for both acceptance and customization) -->
        <div class="login-section" id="loginSection">
            <h2 style="margin-bottom: 20px;" id="loginTitle">Teacher Login</h2>
            <p style="margin-bottom: 20px; color: #666;" id="loginDescription">Enter your name and select your subject</p>
            <input type="text" id="teacherName" placeholder="Enter your name" />
            <select id="teacherSubject" style="padding: 15px 25px; font-size: 1.1em; border: 2px solid #667eea; border-radius: 8px; margin: 10px 0; width: 300px;">
                <option value="">Select your subject</option>
                <option value="math">Mathematics</option>
                <option value="science">Science</option>
                <option value="social">Social Science</option>
            </select>
            <br>
            <div id="loginButtons">
                <button onclick="login()" id="customizeBtn" style="display: none;">Start Customizing</button>
                <button onclick="acceptFromLogin()" id="acceptBtn" style="display: none;">Accept Schedule</button>
            </div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="welcome-bar">
                <h2>Welcome, <span id="teacherNameDisplay"></span>!</h2>
                <button onclick="logout()">Logout</button>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('math')">
                    <h3>üìê Mathematics</h3>
                    <p>Numbers Unit</p>
                </div>
                <div class="tab" onclick="switchTab('science')">
                    <h3>üî¨ Science</h3>
                    <p>Measurements Unit</p>
                </div>
                <div class="tab" onclick="switchTab('social')">
                    <h3>üåç Social Science</h3>
                    <p>Human Evolution Unit</p>
                </div>
                <div class="tab" onclick="switchTab('summary')">
                    <h3>üìä View Summary</h3>
                    <p>Review & Submit</p>
                </div>
            </div>

            <div id="mathContent" class="subject-content active">
                <h2 style="color: #667eea; margin-bottom: 20px;">Mathematics - Unit 1: Numbers</h2>
                <div class="schedule-comparison">
                    <div class="schedule-box">
                        <h3>üìã Current Rigid Schedule</h3>
                        <div id="mathRigid"></div>
                        <div class="total-hours">Total: 10 hours</div>
                    </div>
                    <div class="schedule-box">
                        <h3>‚ú® Your Flexible Schedule</h3>
                        <div id="mathFlexible"></div>
                        <div class="total-hours" id="mathTotal">Total: 0 hours</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="mathChart"></canvas>
                </div>
            </div>

            <div id="scienceContent" class="subject-content">
                <h2 style="color: #667eea; margin-bottom: 20px;">Science - Unit 1: Measurements</h2>
                <div class="schedule-comparison">
                    <div class="schedule-box">
                        <h3>üìã Current Rigid Schedule</h3>
                        <div id="scienceRigid"></div>
                        <div class="total-hours">Total: 10 hours</div>
                    </div>
                    <div class="schedule-box">
                        <h3>‚ú® Your Flexible Schedule</h3>
                        <div id="scienceFlexible"></div>
                        <div class="total-hours" id="scienceTotal">Total: 0 hours</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="scienceChart"></canvas>
                </div>
            </div>

            <div id="socialContent" class="subject-content">
                <h2 style="color: #667eea; margin-bottom: 20px;">Social Science - Unit 1: Human Evolution</h2>
                <div class="schedule-comparison">
                    <div class="schedule-box">
                        <h3>üìã Current Rigid Schedule</h3>
                        <div id="socialRigid"></div>
                        <div class="total-hours">Total: 10 hours</div>
                    </div>
                    <div class="schedule-box">
                        <h3>‚ú® Your Flexible Schedule</h3>
                        <div id="socialFlexible"></div>
                        <div class="total-hours" id="socialTotal">Total: 0 hours</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="socialChart"></canvas>
                </div>
            </div>

            <div id="summaryContent" class="subject-content">
                <h2 style="color: #667eea; margin-bottom: 20px;">üìä Your Unit 1 Plan Summary</h2>
                <div class="summary-section">
                    <h3 style="margin-bottom: 20px;">Your Flexible Pacing Plan for Your Subject</h3>
                    <div class="summary-grid" id="summaryGrid"></div>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn" id="submitPlanBtn">‚úì Submit My Plan</button>
                    <button type="button" class="btn" onclick="resetToFlexible()" style="background: #ffc107; color: #333;">üîÑ Reset to Default</button>
                    <button type="button" class="btn" onclick="window.print()">üñ®Ô∏è Print Summary</button>
                    <button type="button" class="btn" onclick="exportData()">üì• Export Data</button>
                </div>
            </div>
        </div>

        <!-- Step 3: Consolidated View (shown after all teachers submit) -->
        <div class="consolidated-view" id="consolidatedView">
            <h2>üìä All Teachers' Submitted Plans - Unit 1</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">
                Below is the consolidated view of all teacher submissions for Unit 1
            </p>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">Mathematics - Numbers Unit</h3>
                <div style="overflow-x: auto;">
                    <table class="schedule-table" id="mathConsolidatedTable">
                        <!-- Will be populated by JavaScript -->
                    </table>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">Science - Measurements Unit</h3>
                <div style="overflow-x: auto;">
                    <table class="schedule-table" id="scienceConsolidatedTable">
                        <!-- Will be populated by JavaScript -->
                    </table>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">Social Science - Human Evolution Unit</h3>
                <div style="overflow-x: auto;">
                    <table class="schedule-table" id="socialConsolidatedTable">
                        <!-- Will be populated by JavaScript -->
                    </table>
            </div>
            </div>

            <div class="action-buttons">
                <button class="btn" onclick="window.print()">üñ®Ô∏è Print Consolidated Report</button>
                <button class="btn" onclick="exportConsolidatedData()">üì• Export All Data</button>
                <button class="btn" onclick="resetView()">üîÑ Start Over</button>
                <button class="btn" onclick="clearAllData()" style="background: #dc3545;">üóëÔ∏è Clear All Data</button>
            </div>
        </div>
    </div>

    <script>
        const subjectData = {
            math: {
                name: 'Mathematics',
                topics: [
                    { name: 'Introduction', rigid: 1, flexible: 1 },
                    { name: 'Formation of large numbers', rigid: 1, flexible: 0.5 },
                    { name: 'Place Value Chart', rigid: 1, flexible: 2 },
                    { name: 'Comparison of Numbers', rigid: 1, flexible: 1 },
                    { name: 'Creating New Numbers', rigid: 1, flexible: 0.5 },
                    { name: 'Use of Large Numbers in Daily Life Situations', rigid: 1, flexible: 1 },
                    { name: 'Order of Operations', rigid: 1, flexible: 2 },
                    { name: 'Estimation of numbers', rigid: 1, flexible: 0.5 },
                    { name: 'Whole Numbers', rigid: 1, flexible: 1 },
                    { name: 'Properties of Whole Numbers', rigid: 1, flexible: 0.5 }
                ]
            },
            science: {
                name: 'Science',
                topics: [
                    { name: 'Need of measurements in daily life', rigid: 2, flexible: 1 },
                    { name: 'Define length, mass and time', rigid: 2, flexible: 3.5 },
                    { name: 'Values of physical quantities and units', rigid: 2, flexible: 3.5 },
                    { name: 'Errors', rigid: 2, flexible: 1 },
                    { name: 'Measuring tools', rigid: 2, flexible: 1 }
                ]
            },
            social: {
                name: 'Social Science',
                topics: [
                    { name: 'Origin of human', rigid: 2, flexible: 3 },
                    { name: 'Different stages of human evolution', rigid: 2, flexible: 3 },
                    { name: 'Pre-historic humans', rigid: 2, flexible: 2 },
                    { name: 'Paintings', rigid: 2, flexible: 1 },
                    { name: 'Tools and Weapons', rigid: 2, flexible: 1 }
                ]
            }
        };

        let currentTeacher = '';
        let currentTeacherSubject = '';
        let teacherPlans = {};
        let charts = {};

        // Initialize the rigid schedule table on page load
        function initializeRigidScheduleTable() {
            // Load teacher data from localStorage
            const savedData = localStorage.getItem('teacherPlans');
            if (savedData) {
                teacherPlans = JSON.parse(savedData);
            }

            console.log('initializeRigidScheduleTable - teacherPlans:', teacherPlans);

            const tableBody = document.getElementById('rigidScheduleTableBody');
            tableBody.innerHTML = '';

            // Get submitted teachers
            const teachers = Object.keys(teacherPlans).filter(teacher =>
                teacherPlans[teacher].status === 'accepted' || teacherPlans[teacher].status === 'submitted'
            );

            console.log('Submitted teachers:', teachers);

            // Always show Modified Schedule column if there are any submissions
            if (teachers.length > 0) {
                // Show the legend
                document.getElementById('legendSection').style.display = 'block';

                // Show the consolidated view navigation button
                document.getElementById('consolidatedNavButtons').style.display = 'block';

                // Create header with Modified Schedule column
                const headerRow = document.createElement('tr');
                headerRow.innerHTML = '<th>Subject</th><th>Topic</th><th>Rigid Schedule</th><th style="background: #5568d3;">Modified Schedule</th>';

                // Replace table header
                const thead = document.querySelector('#rigidScheduleSection .schedule-table thead');
                thead.innerHTML = '';
                thead.appendChild(headerRow);

                // ALWAYS show all subjects - populate table with data for ALL subjects
                Object.keys(subjectData).forEach(subjectKey => {
                    const subject = subjectData[subjectKey];

                    // Find the teacher for this subject
                    const subjectTeacher = teachers.find(teacher =>
                        teacherPlans[teacher].subject === subjectKey
                    );

                    console.log(`Subject ${subjectKey}: Teacher = ${subjectTeacher}`);

                    // Add subject header row
                    const subjectHeaderRow = document.createElement('tr');
                    subjectHeaderRow.className = 'subject-header';

                    if (subjectTeacher) {
                        // Subject has a teacher assigned
                        subjectHeaderRow.innerHTML = `
                            <td colspan="4"><strong>${subject.name}</strong> (Teacher: ${subjectTeacher}) - Total: ${subject.topics.reduce((sum, t) => sum + t.rigid, 0)} hours</td>
                        `;
                    } else {
                        // Subject does NOT have a teacher assigned
                        subjectHeaderRow.innerHTML = `
                            <td colspan="4"><strong>${subject.name}</strong> <span style="color: #856404; font-size: 0.9em;">‚è≥ Pending Teacher Assignment</span> - Total: ${subject.topics.reduce((sum, t) => sum + t.rigid, 0)} hours</td>
                        `;
                    }
                    tableBody.appendChild(subjectHeaderRow);

                    // Add topic rows
                    subject.topics.forEach((topic, index) => {
                        const row = document.createElement('tr');

                        if (subjectTeacher) {
                            // Subject has teacher - show their customized values
                            const modifiedHours = teacherPlans[subjectTeacher][subjectKey]?.[index] || topic.rigid;
                            const isDifferent = modifiedHours !== topic.rigid;
                            const cellClass = isDifferent ? 'teacher-customized-cell' : '';

                            row.innerHTML = `
                                <td></td>
                                <td>${topic.name}</td>
                                <td>${topic.rigid} ${topic.rigid === 1 ? 'hour' : 'hours'}</td>
                                <td class="${cellClass}">${modifiedHours} ${modifiedHours === 1 ? 'hour' : 'hours'}</td>
                            `;
                        } else {
                            // Subject has NO teacher - show rigid schedule with pending note
                            row.innerHTML = `
                                <td></td>
                                <td>${topic.name}</td>
                                <td>${topic.rigid} ${topic.rigid === 1 ? 'hour' : 'hours'}</td>
                                <td style="color: #999; font-style: italic;">${topic.rigid} ${topic.rigid === 1 ? 'hour' : 'hours'} (default)</td>
                            `;
                        }

                        tableBody.appendChild(row);
                    });
                });
            } else {
                // No submissions yet, show standard rigid schedule for all subjects
                // Hide the consolidated navigation button
                document.getElementById('consolidatedNavButtons').style.display = 'none';

                Object.keys(subjectData).forEach(subjectKey => {
                    const subject = subjectData[subjectKey];

                    // Add subject header row
                    const headerRow = document.createElement('tr');
                    headerRow.className = 'subject-header';
                    headerRow.innerHTML = `
                        <td colspan="2"><strong>${subject.name}</strong></td>
                        <td><strong>Total: ${subject.topics.reduce((sum, t) => sum + t.rigid, 0)} hours</strong></td>
                    `;
                    tableBody.appendChild(headerRow);

                    // Add topic rows
                    subject.topics.forEach(topic => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td></td>
                            <td>${topic.name}</td>
                            <td>${topic.rigid} ${topic.rigid === 1 ? 'hour' : 'hours'}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                });
            }
        }

        function updateSubjectDropdown() {
            // Update the subject dropdown to show which subjects are taken
            const select = document.getElementById('teacherSubject');
            const options = select.querySelectorAll('option');

            options.forEach(option => {
                if (option.value === '') return; // Skip the placeholder option

                const subjectKey = option.value;
                const subjectOwner = Object.keys(teacherPlans).find(teacher =>
                    teacherPlans[teacher].subject === subjectKey &&
                    (teacherPlans[teacher].status === 'accepted' || teacherPlans[teacher].status === 'submitted')
                );

                if (subjectOwner) {
                    option.disabled = true;
                    option.textContent = `${subjectData[subjectKey].name} (Assigned to ${subjectOwner})`;
                    option.style.color = '#999';
                } else {
                    option.disabled = false;
                    option.textContent = subjectData[subjectKey].name;
                    option.style.color = '';
                }
            });
        }

        function showLoginForAcceptance() {
            document.getElementById('rigidScheduleSection').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';

            // Update UI for acceptance flow
            document.getElementById('loginTitle').textContent = 'Accept Rigid Schedule';
            document.getElementById('loginDescription').textContent = 'Enter your name and select your subject to accept the rigid schedule';
            document.getElementById('customizeBtn').style.display = 'none';
            document.getElementById('acceptBtn').style.display = 'inline-block';

            // Update dropdown to show taken subjects
            updateSubjectDropdown();
        }

        function showLoginForCustomization() {
            document.getElementById('rigidScheduleSection').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';

            // Update UI for customization flow
            document.getElementById('loginTitle').textContent = 'Teacher Login';
            document.getElementById('loginDescription').textContent = 'Enter your name and select your subject to begin customizing your lesson schedule';
            document.getElementById('customizeBtn').style.display = 'inline-block';
            document.getElementById('acceptBtn').style.display = 'none';

            // Update dropdown to show taken subjects
            updateSubjectDropdown();
        }

        function acceptFromLogin() {
            const name = document.getElementById('teacherName').value.trim();
            const selectedSubject = document.getElementById('teacherSubject').value;

            if (!name) {
                alert('Please enter your name');
                return;
            }

            if (!selectedSubject) {
                alert('Please select your subject');
                return;
            }

            currentTeacher = name;
            loadTeacherData();

            // Check if this subject is already assigned to another teacher
            const subjectOwner = Object.keys(teacherPlans).find(teacher =>
                teacher !== currentTeacher &&
                teacherPlans[teacher].subject === selectedSubject &&
                (teacherPlans[teacher].status === 'accepted' || teacherPlans[teacher].status === 'submitted')
            );

            if (subjectOwner) {
                const subjectName = subjectData[selectedSubject].name;
                alert(`‚ùå Error: ${subjectName} has already been assigned to ${subjectOwner}.\n\nPlease select a different subject or contact your administrator.`);
                currentTeacher = '';
                return;
            }

            // Confirm acceptance with subject name
            const subjectName = subjectData[selectedSubject].name;
            const confirmMessage = `${currentTeacher}, you are about to accept the rigid schedule for ${subjectName} as-is without any modifications.\n\nDo you want to proceed?`;
            if (!confirm(confirmMessage)) {
                currentTeacher = '';
                return;
            }

            // Save acceptance - copy rigid schedule for their subject only
            teacherPlans[currentTeacher] = {
                status: 'accepted',
                timestamp: new Date().toISOString(),
                subject: selectedSubject
            };

            // Copy rigid values for their subject only
            teacherPlans[currentTeacher][selectedSubject] = {};
            subjectData[selectedSubject].topics.forEach((topic, index) => {
                teacherPlans[currentTeacher][selectedSubject][index] = topic.rigid;
            });

            localStorage.setItem('teacherPlans', JSON.stringify(teacherPlans));

            alert(`‚úì Success!\n\nThank you, ${currentTeacher}!\n\nYou have accepted the rigid schedule for ${subjectName}. Your response has been recorded.`);

            // Clear form and return to rigid schedule page
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherSubject').value = '';
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('rigidScheduleSection').style.display = 'block';

            // Show submission notice
            showSubmissionNotice();

            // Reset current teacher
            currentTeacher = '';
        }

        function login() {
            const name = document.getElementById('teacherName').value.trim();
            const subject = document.getElementById('teacherSubject').value;

            if (!name) {
                alert('Please enter your name');
                return;
            }

            if (!subject) {
                alert('Please select your subject');
                return;
            }

            // Check if this subject is already assigned to another teacher
            const subjectOwner = Object.keys(teacherPlans).find(teacher =>
                teacher !== name &&
                teacherPlans[teacher].subject === subject &&
                (teacherPlans[teacher].status === 'accepted' || teacherPlans[teacher].status === 'submitted')
            );

            if (subjectOwner) {
                const subjectName = subjectData[subject].name;
                alert(`‚ùå Error: ${subjectName} has already been assigned to ${subjectOwner}.\n\nPlease select a different subject or contact your administrator.`);
                return;
            }

            currentTeacher = name;
            currentTeacherSubject = subject;
            document.getElementById('teacherNameDisplay').textContent = name;
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';

            loadTeacherData();

            // Store the subject for this teacher
            if (!teacherPlans[currentTeacher]) {
                teacherPlans[currentTeacher] = {
                    status: 'customizing',
                    subject: currentTeacherSubject
                };
            } else {
                teacherPlans[currentTeacher].subject = currentTeacherSubject;
            }

            // Save to localStorage immediately
            localStorage.setItem('teacherPlans', JSON.stringify(teacherPlans));

            // Initialize only the teacher's subject
            initializeTeacherSubject();

            // Hide all tabs and show only the teacher's subject tab
            hideOtherSubjectTabs();

            // Attach submit button event listener after content is visible
            setTimeout(() => {
                const submitBtn = document.getElementById('submitPlanBtn');
                if (submitBtn) {
                    submitBtn.onclick = function(e) {
                        e.preventDefault();
                        submitPlan();
                    };
                }
            }, 100);
        }

        function logout() {
            currentTeacher = '';
            currentTeacherSubject = '';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('rigidScheduleSection').style.display = 'block';
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherSubject').value = '';
        }

        function loadTeacherData() {
            const savedData = localStorage.getItem('teacherPlans');
            if (savedData) {
                teacherPlans = JSON.parse(savedData);
            }
            if (!teacherPlans[currentTeacher]) {
                teacherPlans[currentTeacher] = {
                    status: 'customizing'
                };
            }
        }

        function submitPlan() {
            if (!currentTeacher || currentTeacher === '') {
                alert('Error: No teacher logged in. Please log in first.');
                return;
            }

            if (!currentTeacherSubject) {
                alert('Error: No subject selected. Please log in again.');
                return;
            }

            // Validate only the teacher's subject
            const subject = subjectData[currentTeacherSubject];
            let total = 0;

            subject.topics.forEach((topic, index) => {
                let value = teacherPlans[currentTeacher]?.[currentTeacherSubject]?.[index];
                if (value === undefined || value === null) {
                    value = topic.flexible;
                }
                const numValue = parseFloat(value);
                if (!isNaN(numValue)) {
                    total += numValue;
                }
            });

            const isValid = Math.abs(total - 10) < 0.1;

            // Build confirmation message
            let message = `üìù You have made changes to the ${subject.name} lesson schedule.\n\n`;
            message += 'Your customized plan:\n\n';
            message += `${subject.name}: ${total.toFixed(1)} hours ${isValid ? '‚úì' : '‚ö† (Should be 10 hours)'}\n`;

            if (!isValid) {
                message += '\n‚ö† Warning: Your subject does not total 10 hours.\n';
            }

            message += '\nDo you want to submit these changes?';

            // Ask for confirmation
            if (!confirm(message)) {
                return;
            }

            // Save the submission
            teacherPlans[currentTeacher].status = 'submitted';
            teacherPlans[currentTeacher].timestamp = new Date().toISOString();
            teacherPlans[currentTeacher].subject = currentTeacherSubject;

            console.log('Saving teacher plan:', currentTeacher, teacherPlans[currentTeacher]);
            localStorage.setItem('teacherPlans', JSON.stringify(teacherPlans));

            // Show success message
            alert(`‚úì Success!\n\nThank you, ${currentTeacher}!\n\nYour customized lesson plan has been submitted successfully.\n\nYou will now be returned to the main page.`);

            // Return to rigid schedule page (initial view)
            currentTeacher = '';
            currentTeacherSubject = '';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('rigidScheduleSection').style.display = 'block';
            document.getElementById('teacherName').value = '';
            document.getElementById('teacherSubject').value = '';

            // Show a notice on the rigid schedule page
            showSubmissionNotice();
        }

        function showSubmissionNotice() {
            // Refresh the rigid schedule table to show the new submission
            initializeRigidScheduleTable();

            // Check if notice already exists
            let existingNotice = document.getElementById('submissionNotice');
            if (existingNotice) {
                existingNotice.remove();
            }

            // Create submission notice
            const notice = document.createElement('div');
            notice.id = 'submissionNotice';
            notice.style.cssText = `
                background: #d4edda;
                color: #155724;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
                text-align: center;
                border: 2px solid #28a745;
            `;
            notice.innerHTML = `
                <h3 style="margin: 0 0 10px 0;">‚úì Submission Successful</h3>
                <p style="margin: 0;">Your customized lesson plan has been recorded. The table below now shows all teacher submissions.</p>
                <button class="btn" onclick="showConsolidatedView()" style="margin-top: 15px; background: #28a745;">
                    üìä View Detailed Consolidated Report
                </button>
            `;

            // Insert notice at the top of the rigid schedule section
            const rigidSection = document.getElementById('rigidScheduleSection');
            rigidSection.insertBefore(notice, rigidSection.firstChild);
        }

        function exportData() {
            const dataStr = JSON.stringify(teacherPlans[currentTeacher], null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${currentTeacher}_unit1_plan.json`;
            link.click();
        }

        function checkAndShowConsolidatedView() {
            // For demo purposes, show consolidated view if at least one teacher has submitted
            const submittedTeachers = Object.keys(teacherPlans).filter(teacher =>
                teacherPlans[teacher].status === 'accepted' || teacherPlans[teacher].status === 'submitted'
            );

            if (submittedTeachers.length > 0) {
                // Ask if user wants to view consolidated report
                if (confirm('Would you like to view the consolidated report of all teacher submissions?')) {
                    showConsolidatedView();
                }
            }
        }

        function showConsolidatedView() {
            // Reload data from localStorage to ensure we have the latest submissions
            const savedData = localStorage.getItem('teacherPlans');
            if (savedData) {
                teacherPlans = JSON.parse(savedData);
            }

            document.getElementById('rigidScheduleSection').style.display = 'none';
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('consolidatedView').style.display = 'block';

            generateConsolidatedTables();
        }

        function generateConsolidatedTables() {
            console.log('generateConsolidatedTables - Full teacherPlans:', teacherPlans);

            const teachers = Object.keys(teacherPlans).filter(teacher =>
                teacherPlans[teacher].status === 'accepted' || teacherPlans[teacher].status === 'submitted'
            );

            console.log('Filtered teachers:', teachers);

            ['math', 'science', 'social'].forEach(subjectKey => {
                const tableContainer = document.getElementById(`${subjectKey}ConsolidatedTable`).parentElement.parentElement;
                const table = document.getElementById(`${subjectKey}ConsolidatedTable`);
                const subject = subjectData[subjectKey];

                // Check if any teacher is assigned to this subject
                const subjectTeachers = teachers.filter(teacher =>
                    teacherPlans[teacher].subject === subjectKey
                );

                // Hide the entire subject section if no teacher assigned
                if (subjectTeachers.length === 0) {
                    tableContainer.style.display = 'none';
                    return;
                }

                // Show the section if hidden
                tableContainer.style.display = 'block';

                let headerHTML = '<thead><tr><th>Topic</th><th>Rigid Schedule</th>';
                subjectTeachers.forEach(teacher => {
                    headerHTML += `<th class="teacher-column">${teacher}</th>`;
                });
                headerHTML += '</tr></thead>';

                let bodyHTML = '<tbody>';
                subject.topics.forEach((topic, index) => {
                    bodyHTML += `<tr>
                        <td><strong>${topic.name}</strong></td>
                        <td>${topic.rigid} hrs</td>`;

                    subjectTeachers.forEach(teacher => {
                        const hours = teacherPlans[teacher][subjectKey]?.[index] || topic.rigid;
                        console.log(`Teacher: ${teacher}, Subject: ${subjectKey}, Topic ${index}: ${hours} (from teacherPlans[${teacher}][${subjectKey}][${index}] = ${teacherPlans[teacher][subjectKey]?.[index]})`);
                        const status = teacherPlans[teacher].status;
                        const badge = status === 'accepted' ?
                            '<span class="status-badge status-accepted">Accepted</span>' :
                            '<span class="status-badge status-customized">Custom</span>';
                        bodyHTML += `<td>${hours} hrs</td>`;
                    });
                    bodyHTML += '</tr>';
                });

                // Add total row
                bodyHTML += '<tr style="background: #f0f2ff; font-weight: bold;"><td>TOTAL</td>';
                bodyHTML += `<td>${subject.topics.reduce((sum, t) => sum + t.rigid, 0)} hrs</td>`;

                subjectTeachers.forEach(teacher => {
                    let total = 0;
                    subject.topics.forEach((topic, index) => {
                        total += teacherPlans[teacher][subjectKey]?.[index] || topic.rigid;
                    });
                    bodyHTML += `<td>${total.toFixed(1)} hrs</td>`;
                });
                bodyHTML += '</tr>';

                bodyHTML += '</tbody>';
                table.innerHTML = headerHTML + bodyHTML;
            });
        }

        function exportConsolidatedData() {
            const dataStr = JSON.stringify(teacherPlans, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'consolidated_unit1_plans.json';
            link.click();
        }

        function resetView() {
            if (confirm('Are you sure you want to start over? This will return to the initial view but keep saved data.')) {
                document.getElementById('consolidatedView').style.display = 'none';
                document.getElementById('rigidScheduleSection').style.display = 'block';
            }
        }

        function clearAllData() {
            const confirmClear = confirm('‚ö†Ô∏è CLEAR ALL DATA\n\nThis will permanently delete ALL teacher submissions and reset the tool to its initial state.\n\nThis action CANNOT be undone.\n\nAre you absolutely sure you want to continue?');

            if (!confirmClear) {
                return;
            }

            // Double confirmation for safety
            const doubleConfirm = confirm('‚ö†Ô∏è FINAL WARNING\n\nYou are about to delete:\n- All teacher submissions\n- All customizations\n- All accepted schedules\n\nClick OK to DELETE ALL DATA, or Cancel to keep your data.');

            if (!doubleConfirm) {
                return;
            }

            // Clear localStorage
            localStorage.removeItem('teacherPlans');

            // Reset in-memory data
            teacherPlans = {};
            currentTeacher = '';
            currentTeacherSubject = '';

            // Reset UI
            document.getElementById('consolidatedView').style.display = 'none';
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('rigidScheduleSection').style.display = 'block';

            // Remove submission notice if it exists
            const existingNotice = document.getElementById('submissionNotice');
            if (existingNotice) {
                existingNotice.remove();
            }

            // Hide legend
            document.getElementById('legendSection').style.display = 'none';

            // Reinitialize the table to show default state
            initializeRigidScheduleTable();

            alert('‚úì All Data Cleared\n\nAll teacher data has been successfully deleted. The tool has been reset to its initial state.');
        }

        function initializeAll() {
            initializeSubject('math');
            initializeSubject('science');
            initializeSubject('social');
        }

        function initializeTeacherSubject() {
            // Only initialize the subject that the teacher teaches
            initializeSubject(currentTeacherSubject);
            // Automatically switch to that subject's tab
            switchTab(currentTeacherSubject);
        }

        function hideOtherSubjectTabs() {
            const tabs = document.querySelectorAll('.tab');

            // Hide all subject tabs except the teacher's subject and summary
            tabs.forEach((tab, index) => {
                // Index 0 = math, 1 = science, 2 = social, 3 = summary
                if (index === 0) { // Math tab
                    tab.style.display = (currentTeacherSubject === 'math') ? 'block' : 'none';
                } else if (index === 1) { // Science tab
                    tab.style.display = (currentTeacherSubject === 'science') ? 'block' : 'none';
                } else if (index === 2) { // Social tab
                    tab.style.display = (currentTeacherSubject === 'social') ? 'block' : 'none';
                } else if (index === 3) { // Summary tab
                    tab.style.display = 'block'; // Always show summary for submit
                }
            });
        }

        function initializeSubject(subject) {
            const data = subjectData[subject];
            const rigidContainer = document.getElementById(`${subject}Rigid`);
            const flexibleContainer = document.getElementById(`${subject}Flexible`);
            
            rigidContainer.innerHTML = '';
            flexibleContainer.innerHTML = '';
            
            data.topics.forEach((topic, index) => {
                // Rigid schedule display
                const rigidRow = document.createElement('div');
                rigidRow.className = 'topic-row';
                rigidRow.innerHTML = `
                    <label>${topic.name}</label>
                    <div class="hours-display">${topic.rigid} hours</div>
                `;
                rigidContainer.appendChild(rigidRow);
                
                // Flexible schedule input
                const flexibleRow = document.createElement('div');
                flexibleRow.className = 'topic-row';
                const savedValue = teacherPlans[currentTeacher]?.[subject]?.[index] || topic.flexible;
                flexibleRow.innerHTML = `
                    <label>${topic.name}</label>
                    <input type="number" step="0.5" min="0" max="10" value="${savedValue}" 
                           onchange="updateFlexible('${subject}', ${index}, this.value)" />
                `;
                flexibleContainer.appendChild(flexibleRow);
            });
            
            updateTotal(subject);
            createChart(subject);
        }

        function updateFlexible(subject, index, value) {
            if (!teacherPlans[currentTeacher][subject]) {
                teacherPlans[currentTeacher][subject] = {};
            }
            const numValue = parseFloat(value);
            if (isNaN(numValue) || numValue < 0) {
                alert('Please enter a valid positive number');
                return;
            }
            teacherPlans[currentTeacher][subject][index] = numValue;
            updateTotal(subject);
            updateChart(subject);
        }

        function updateTotal(subject) {
            const data = subjectData[subject];
            let total = 0;

            data.topics.forEach((topic, index) => {
                // Get the value from teacher's plan, or use the default flexible value
                let value = teacherPlans[currentTeacher]?.[subject]?.[index];

                // If value doesn't exist, use the flexible value from subject data
                if (value === undefined || value === null) {
                    value = topic.flexible;
                }

                // Ensure we're working with a number
                const numValue = parseFloat(value);
                if (!isNaN(numValue)) {
                    total += numValue;
                }
            });

            const totalElement = document.getElementById(`${subject}Total`);
            totalElement.textContent = `Total: ${total.toFixed(1)} hours`;

            // Warning if total doesn't equal 10
            if (Math.abs(total - 10) < 0.1) {
                totalElement.className = 'total-hours';
            } else {
                totalElement.className = 'total-hours warning';
            }
        }

        function createChart(subject) {
            const data = subjectData[subject];
            const ctx = document.getElementById(`${subject}Chart`).getContext('2d');

            const labels = data.topics.map(t => t.name.length > 30 ? t.name.substring(0, 30) + '...' : t.name);
            const rigidData = data.topics.map(t => t.rigid);
            const flexibleData = data.topics.map((t, i) => {
                let value = teacherPlans[currentTeacher]?.[subject]?.[i];
                if (value === undefined || value === null) {
                    value = t.flexible;
                }
                return parseFloat(value);
            });
            
            charts[subject] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Rigid Schedule (hours)',
                        data: rigidData,
                        backgroundColor: 'rgba(220, 53, 69, 0.5)',
                        borderColor: 'rgba(220, 53, 69, 1)',
                        borderWidth: 2
                    }, {
                        label: 'Flexible Schedule (hours)',
                        data: flexibleData,
                        backgroundColor: 'rgba(102, 126, 234, 0.5)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Hours'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Rigid vs Flexible Schedule Comparison',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        function updateChart(subject) {
            const data = subjectData[subject];
            const flexibleData = data.topics.map((t, i) => {
                let value = teacherPlans[currentTeacher]?.[subject]?.[i];
                if (value === undefined || value === null) {
                    value = t.flexible;
                }
                return parseFloat(value);
            });

            charts[subject].data.datasets[1].data = flexibleData;
            charts[subject].update();

            // Update summary if on summary tab
            if (document.getElementById('summaryContent').classList.contains('active')) {
                generateSummary();
            }
        }

        function switchTab(tab) {
            // Update tab styling
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

            // Find and activate the correct tab
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((t, index) => {
                const tabName = ['math', 'science', 'social', 'summary'][index];
                if (tabName === tab) {
                    t.classList.add('active');
                }
            });

            // Update content
            document.querySelectorAll('.subject-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`${tab}Content`).classList.add('active');

            if (tab === 'summary') {
                generateSummary();
            }
        }

        function resetToFlexible() {
            if (!currentTeacher || !currentTeacherSubject) {
                alert('Error: No teacher logged in.');
                return;
            }

            const subjectName = subjectData[currentTeacherSubject].name;
            const confirmReset = confirm(`‚ö†Ô∏è Reset to Default\n\nThis will reset all your customizations for ${subjectName} back to the flexible default values.\n\nAre you sure you want to continue?`);

            if (!confirmReset) {
                return;
            }

            // Clear all customizations for this subject
            if (teacherPlans[currentTeacher]) {
                delete teacherPlans[currentTeacher][currentTeacherSubject];
            }

            // Re-initialize the subject to show default values
            initializeSubject(currentTeacherSubject);
            updateTotal(currentTeacherSubject);
            updateChart(currentTeacherSubject);

            // Refresh summary if on summary tab
            if (document.getElementById('summaryContent').classList.contains('active')) {
                generateSummary();
            }

            alert(`‚úì Reset Complete\n\nAll customizations for ${subjectName} have been reset to the flexible default values.`);
        }

        function generateSummary() {
            const summaryGrid = document.getElementById('summaryGrid');
            summaryGrid.innerHTML = '';

            // Only show the teacher's subject in the summary
            const subject = currentTeacherSubject;
            const data = subjectData[subject];
            const card = document.createElement('div');
            card.className = 'summary-card';

            let summaryHTML = `<h4>${data.name}</h4>`;

            data.topics.forEach((topic, index) => {
                // Get the teacher's custom hours
                const customHours = teacherPlans[currentTeacher]?.[subject]?.[index];
                const flexHours = customHours !== undefined ? customHours : topic.flexible;

                // Compare custom hours to the original flexible default
                // If teacher didn't customize (customHours is undefined), show no change
                let difference, arrow, color;
                if (customHours !== undefined) {
                    // Teacher customized this topic - compare to flexible default
                    difference = customHours - topic.flexible;
                    arrow = difference > 0 ? '‚Üë' : difference < 0 ? '‚Üì' : '=';
                    color = difference > 0 ? 'green' : difference < 0 ? 'red' : 'gray';
                } else {
                    // Teacher hasn't customized - no change from flexible
                    difference = 0;
                    arrow = '=';
                    color = 'gray';
                }

                // Format the difference display
                let diffDisplay = '';
                if (difference !== 0) {
                    diffDisplay = ` (${difference > 0 ? '+' : ''}${difference.toFixed(1)}h)`;
                }

                summaryHTML += `
                    <div class="summary-item">
                        <span>${topic.name}</span>
                        <span style="color: ${color}; font-weight: bold;">
                            ${flexHours}h ${arrow}${diffDisplay}
                        </span>
                    </div>
                `;
            });

            card.innerHTML = summaryHTML;
            summaryGrid.appendChild(card);
        }

        // Initialize rigid schedule table on page load
        window.addEventListener('DOMContentLoaded', () => {
            initializeRigidScheduleTable();
        });
    </script>
</body>
</html>
